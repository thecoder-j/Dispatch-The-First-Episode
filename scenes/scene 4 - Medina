#include <iostream>
#include <thread>
#include <chrono>
#include <sstream>
using namespace std;

// ---------- Typing Effects ----------
// Word-by-word for dialogue
void printWords(const string &text, int wordDelayMs = 120) {
    stringstream ss(text);
    string word;
    while (ss >> word) {
        cout << word << " " << flush;
        this_thread::sleep_for(chrono::milliseconds(wordDelayMs));
    }
    cout << endl;
}

// Line-by-line for actions
void printLines(const string &text, int lineDelayMs = 500) {
    stringstream ss(text);
    string line;
    while (getline(ss, line, '\n')) {
        cout << line << endl;
        this_thread::sleep_for(chrono::milliseconds(lineDelayMs));
    }
}

// Simple choice reader
int readChoice() {
    int choice;
    while (true) {
        if (cin >> choice) return choice;
        cin.clear();
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
        cout << "Please enter a valid number: ";
    }
}

// ---------- Scene 4: Billboard ----------
void scene_billboard(int &relationshipScore, int &publicChaos) {
    int choice;

    cout << "\n===== Scene 4: Billboard =====\n\n";

    // Actions
    printLines("*Mecha Man flies to the alleyway*");
    printLines("*Blonde Blazer walks out the bar*");

    // Dialogue
    printWords("Blonde Blazer: Hey, I couldn't find you.");
    printWords("Mecha Man: Uh, it's cool. I was just admiring the art on this dumpster.");
    printWords("Can't tell why anyone would put those words together.");
    printLines("*Shows a dumpster with 'FART BART' plastered on it*");

    printWords("Mecha Man: Why're you holding two drinks?");
    printWords("Blonde Blazer: Nightcap?");
    printWords("Mecha Man: You're trouble.");
    printWords("Blonde Blazer: Actually, according to the bartender, that's exactly what you are.");

    printWords("Blonde Blazer: What happened in there?");
    printWords("Blonde Blazer: I walk out and the bartender's pissed. The whole energy is awkward...");
    printWords("...And why did it smell like burnt hair?");

    printWords("Mecha Man: I got a little fired up with the guy, but he ran off before anything happened.");
    printWords("Blonde Blazer: Oh, you got fired up?");
    printWords("Mecha Man: Yeah. Does that not sound convincing enough?");
    printWords("Blonde Blazer: Hold these. I know a place. It's a little out there. Easier if we fly.");

    printLines("*Mecha Man and Blonde Blazer land on the billboard*  (à¸‡â€¢Ì€_â€¢Ì)à¸‡");
    printLines("*City lights glow beneath them*  âœ¨ðŸ™ï¸");

    printWords("Robert: I actually thought you were taking us to sit on it.");
    printWords("Blonde Blazer: Hmm! Oh yeah, that woulda been cool. But no, this is better 'cause you can see it.");
    printWords("And it looks like there's a couple up there already.");

    // Player choice
    cout << "\n1. I really needed this.\n2. Thanks for helping me.\n3. Sorry about the spit thing.\nChoice: ";
    choice = readChoice();

    if (choice == 1) {
        printWords("Robert: All this has been pretty overwhelming, you know.");
        printWords("I don't get out often, and I think I really needed this.");
        printWords("So thank you. For bringing me out. I had a really great time.");
        relationshipScore += 2; // good bonding
    } else if (choice == 2) {
        printWords("Robert: I really appreciate you coming to my rescue back there.");
        printWords("I still think I could've handled it, but... Thanks. I should've just said that.");
        printWords("But yep. I'm still talking.");
        relationshipScore += 1; // moderate bonding
    } else if (choice == 3) {
        printWords("Robert: I know I shouldn't bring it up, but I am seriously sorry about the whole spitting thing.");
        printWords("Blonde Blazer: Yeah, usually like a second date kinda thing with me. I'm joking. Not a date.");
        printWords("Robert: No. Totally. Yeah.");
        relationshipScore += 0; // neutral
    } else {
        printWords("Robert: Yeah... ignore that.");
    }

    printWords("Blonde Blazer: Don't worry about it, Robert Roberson.");
    printWords("Robert: How do you know my name?");
    printWords("Blonde Blazer: Whoops!");
    printWords("Robert: What's going on?");
    printWords("Blonde Blazer: Okay, I'll tell you. But only after you tell me how you ended up with a name like that.");

    printWords("Robert: Oh, you mean Robert Roberson the Third?");
    printWords("Blonde Blazer: The Third?! Three times this happened?");
    printWords("Robert: Grandpa Bobby, then Dad (Robbie), then me. Cause I wanted to be taken seriously.");
    printWords("Blonde Blazer: A family tradition.");
    printWords("Robert: In more ways than one. Gramps was the first Mecha Man. He died in the suit before I was born.");
    printWords("Dad was killed fighting Shroud. That's when I took over. There was a little inheritance and life insurance money.");

    printWords("Blonde Blazer: I'm so sorry. I didn't realize.");
    printWords("Robert: Just your run-of-the-mill sad superhero origin story.");
    printWords("Blonde Blazer: The family tradition is dying in that suit. Which I guess I don't have to worry about anymore.");

    printWords("Mecha Man: What is it?");
    printWords("Blonde Blazer: I'm not quite drunk enough to share my origin story yet. But remind me to tell you someday.");
    printWords("Robert: Definitely.");

    printLines("*Blonde Blazer sits close to Robert*");
    printLines("*She gently touches Robertâ€™s face*  (ã€ƒÏ‰ã€ƒ)");
    printLines("*Blonde Blazer removes his mask*  ( ï¾‰ ï¾Ÿï½°ï¾Ÿ)ï¾‰");
    printLines("*She looks intently into his eyes* (*â‰§ï¸¶â‰¦))(ï¿£â–½ï¿£* )ã‚ž");
    printWords("Blonde Blazer: We can work with this.");

    cout << "\n1. Kiss her\n2. Let the moment pass\nChoice: ";
    choice = readChoice();

    if (choice == 1) {
        printLines("*You lean in and kiss her*  ( Ë˜ Â³Ë˜)â™¥");
        printWords("Blonde Blazer: No. This... I'm sorry if I gave the wrong impression.");
        relationshipScore += 2; // risky but bonding
        publicChaos += 1; // small attention
    } else if (choice == 2) {
        printLines("*You hesitate and pull back*  (â€¢_â€¢)");
        printWords("Blonde Blazer: Sorry. I'm actually here with a purpose.");
        relationshipScore += 1; // safe bonding
    } else {
        printWords("Robert: Uh... yeah.");
    }

    printWords("Robert: Oh no.");
    printWords("Blonde Blazer: It's my fault.");
    printWords("Robert: I'm so sorry, I totally misread that--");
    printWords("Blonde Blazer: You didn't. I mean, you did, but...");
    printWords("The way I went about tonight... it was all a little loose, a little unprofessional...");
    printWords("Robert: Unprofessional? I'm not sure that applies but... okay.");

    printWords("Blonde Blazer: I'm actually here on official business... how I know your name, the proposition I mentioned right before you spit in my mouth--");
    printWords("Robert: Still mortified about that.");
    printWords("Blonde Blazer: It's fine. Do you remember a superhero named Trackstar?");
    printWords("Robert: Remember? Of course. He's like family I haven't talked to in a while. What about him?");
    printWords("Blonde Blazer: I work with him at SDN. He recommended you. Mentioned he worked with your father.");
    printWords("Robert: Yeah, he was the youngest member of the Brave Brigade, kind of my babysitter for a while. How's he doing?");
    printWords("Blonde Blazer: He's doing great. He's why I'm here.");

    printWords("Blonde Blazer: Robert, I would like to make you an offer.");
    printWords("In exchange for dispatching and mentoring some of our rookie heroes, SDN can make you Mecha Man again.");
    printWords("But this time with all the resources that a company as big as ours has at their disposal.");
    printWords("No more paying out of pocket for repairs, support staff, the whole shebang.");

    printWords("Robert: My suit was totally destroyed...");
    printWords("Blonde Blazer: I saw the report, studied the footage.");
    printWords("It's not totally destroyed, just mostly.");
    printWords("Big investment, it'll take considerable time and money to get the suit repaired and missing pieces replaced.");
    printWords("Plenty of time to learn how to dispatch and level up some heroes on our roster.");
    printWords("Your experience, work ethic, perspectiveâ€”it's all invaluable. Share it, Robert. You have a lot left to give.");

    cout << "\n===== End of Scene 4 =====\n";
    cout << "Current Relationship Score: " << relationshipScore << "\n";
    cout << "Current Public Chaos: " << publicChaos << "\n";
}

int main() {
    int relationshipScore = 0;
    int publicChaos = 0;

    scene_billboard(relationshipScore, publicChaos);

    return 0;
}
