#include <iostream>
#include <thread>
#include <chrono>
#include <sstream>
using namespace std;

int impressionScore = 0;
int publicChaos = 0;

// Word-by-word printing for dialogue
void printWords(const string &text, int wordDelayMs = 150) {
    stringstream ss(text);
    string word;
    while (ss >> word) {
        cout << word << " " << flush;
        this_thread::sleep_for(chrono::milliseconds(wordDelayMs));
    }
    cout << endl;
}

// Line-by-line printing for actions
void printLines(const string &text, int lineDelayMs = 600) {
    stringstream ss(text);
    string line;
    while (getline(ss, line, '\n')) {
        cout << line << endl;
        this_thread::sleep_for(chrono::milliseconds(lineDelayMs));
    }
}

// Choice reader
int readChoice() {
    int choice;
    while (true) {
        if (cin >> choice) return choice;
        cin.clear();
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
        cout << "Please enter a valid number: ";
    }
}

/* ---------- Scene 3: Bar Flambae ---------- */
void scene_bar_flambae() {
    int choice;

    cout << "\n===== Scene 3: Bar Flambae =====\n\n";

    printLines("*A glass shatters nearby*  (â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»");
    printWords("Mecha Man: What're you doing?");
    printWords("Person: Hey! Bitch!..... Hey! I'm talkin' to you, bitch!");
    printWords("Mecha Man: Alright, just so you know, I only turned around cause someone yelled, not because I'm a bitch or anything.");

    printWords("Person: Don't you watch the news? This is a superhero bar.");
    printWords("Mecha Man: Oh, wow, are you a superhero? That's so cool.");
    printWords("Is this your power?");
    printWords("You're like, tell people obvious shit guy?");

    printWords("Person: You're really gonna act like you don't remember me?");
    printWords("Mecha Man: Wait, it's coming back to me...");
    printWords("Yeah, it's coming back to me...");

    // Character identity choice
    cout << "\n1. Dr. Don't Do Shit";
    cout << "\n2. Mr. Wet Ponytail";
    cout << "\n3. Sunglasses at Night Guy";
    cout << "\nChoice: ";
    choice = readChoice();

    printWords("Oh wait, I know it.");

    if (choice == 1) {
        printWords("You are Dr. Don't Do Shit.");
        printWords("Your deal is you walk up to people, look threatening, talk a big game, then don't do shit about it.");
        printWords("Also, you're not a real doctor cause you're a fuckin' idiot.");
        impressionScore -= 1;  // bad impression
    }
    else if (choice == 2) {
        printWords("You are Mr. Wet Ponytail.");
        printWords("Your superpower is in your ponytail, which aside from being disgusting, has the ability to never not be wet.");
        printWords("In battle, you whip it around and anyone it touches fuckin' kills themself.");
        impressionScore -= 2;  // worse impression
    }
    else if (choice == 3) {
        printWords("You are Sunglasses Indoors at Night Guy.");
        printWords("Your superpower is letting everyone know in the room that you're a douchebag.");
        printWords("Cause you should literally never do that.");
        impressionScore -= 1;
    }
    else {
        printWords("Mecha Man: ...Yeah, I lost it.");
        impressionScore -= 1;
    }
    
    printLines("*Someone chuckles*");
    printWords("Person: You good?");
    printWords("Woman: Sorry, I choked on my spit.");
    printWords("Person: No, Mecha Bitch. I control the fire--");

    printWords("Mecha Man: The fire?");
    printWords("Person: And the flame.");
    printWords("And my skin does not burn.");
    printWords("I am Flambae.");

    printWords("Mecha Man: Wait, oh shit. I do remember you.");
    printWords("You're that shitty villain I busted up.");

    printWords("Flambae: Not anymore, Mecha Dick.");
    printWords("As I literally just said, I am Flambae, a real superhero.");
    printWords("And you are not Mecha Man anymore.");
    printWords("So you need to get the fuck out of here.");

    // Water or Alcohol choice
    cout << "\n1. Water";
    cout << "\n2. Alcohol";
    cout << "\nChoice: ";
    choice = readChoice();

    if (choice == 1) {
        printLines("*You throw water on Flambae*  (ã£ãƒ»Ï‰ãƒ»)ã£ðŸ’§");
        printWords("Mecha Man: There. The easy way.");
        printWords("Flambae: I've been waiting a long time for this.");
        printLines("*Flambae charges, slips, and knocks himself out*  (x_x)");
        printLines("*Coupe and Punch-up runoff to get him*");
        printWords("Dobble: Hey, why don't you do us a favor and step out of this bar.");        
        printWords("Mecha Man: I get it. Can you just tell Blazer I'm outside?");
        printLines("*Dopple duplicates*");
        printWords("Dopple: OUT!.");
        printWords("Mecha Man: Relax! I'm leaving.");
        publicChaos += 1;  // minor chaos
        impressionScore += 1; // Flambae slightly impressed by efficiency
    }
    else if (choice == 2) {
        printLines("*You throw alcohol on Flambae*  (ã£ðŸ”¥)ã£ðŸ¥ƒ\n*The flames burn Flambae as he screams*  (ðŸ”¥ðŸ”¥ðŸ”¥)");
        printWords("Mecha Man: Sorry, which way was that.");
        printLines("*A man hurries to grab a tray*");
        printWords("Waiter: Hey!.");
        printWords("Coupe: No, Punch-up, you are literally fanning the flames right now.");
        printWords("Punch-up: Shit, you're right. Anybody got a rug?");
        printWords("Flambae: Fuck!");
        printLines("*Flambae rushes out of the bar screaming*");
        printWords("Punch-up: You gotta drop and roll, lad");
        printWords("Mecha Man: I thought he doesn't burn");
        printWords("Coupe: Some people become scared before they even know they're hurt...");
        printWords("Coupe: like babies.");
        printLines("*Coupe walks out*");
        printWords("Dopple: HEY! Mecha Dick. Get the fuck out of here.");
        printWords("Mecha Man: I get it. Can you just tell Blazer I'm outside?");
        printLines("*Dopple duplicates*");
        printWords("Dopple: OUT!.");
        printWords("Mecha Man: Relax! I'm leaving.");
        publicChaos += 3;  // major chaos
        impressionScore -= 1; // Flambae slightly annoyed
    }
    else {
        printWords("Mecha Man: Yeah... bad call.");
    }

    // Show score at end
    cout << "\n===== End of Scene 3 =====\n";
    cout << "Current Impression Score: " << impressionScore << endl;
    cout << "Current Public Chaos: " << publicChaos << endl;
}

/* ---------- Standalone Main ---------- */
int main() {
    scene_bar_flambae();
    return 0;
}
