#include <iostream>
#include <thread>
#include <chrono>
#include <sstream>
#include <limits>
using namespace std;

int impressionScore = 0;
int publicChaos = 0;

// Word-by-word printing for dialogue
void printWords(const string &text, int wordDelayMs = 150) {
    stringstream ss(text);
    string word;
    while (ss >> word) {
        cout << word << " " << flush;
        this_thread::sleep_for(chrono::milliseconds(wordDelayMs));
    }
    cout << endl;
}

// Line-by-line printing for actions
void printLines(const string &text, int lineDelayMs = 600) {
    stringstream ss(text);
    string line;
    while (getline(ss, line, '\n')) {
        cout << line << endl;
        this_thread::sleep_for(chrono::milliseconds(lineDelayMs));
    }
}

// Wait for Enter key press
void waitForEnter(const string &prompt = "\n[Press Enter to continue...]") {
    cout << prompt << flush;
    cin.ignore(numeric_limits<streamsize>::max(), '\n');
}

// Enhanced choice reader with range validation
int readChoice(int min = 1, int max = 3) {
    int choice;
    while (true) {
        if (cin >> choice && choice >= min && choice <= max) {
            cin.ignore(numeric_limits<streamsize>::max(), '\n');
            return choice;
        }
        cin.clear();
        cin.ignore(numeric_limits<streamsize>::max(), '\n');
        cout << "Invalid choice. Please enter " << min << "-" << max << ": ";
    }
}

/* ---------- Scene 4: Bar Flambae ---------- */
void scene_bar_flambae() {
    int choice;

    // Wait for player to start the scene
    waitForEnter("\n[Press Enter to begin Scene 4...]");
    
    cout << "\n=========================================\n";
    cout << "     SCENE 4: THE SUPERHERO BAR\n";
    cout << "=========================================\n\n";

    printLines("*CRASH! A glass shatters nearby*  (â•¯Â°â–¡Â°ï¼‰â•¯ï¸µ â”»â”â”»");
    this_thread::sleep_for(chrono::milliseconds(500));
    
    printWords("Mecha Man: What're you doing?");
    printWords("Person: Hey! Bitch!..... Hey! I'm talkin' to you, bitch!");
    printWords("Mecha Man: Alright, just so you know, I only turned around cause someone yelled, not because I'm a bitch or anything.");

    printWords("Person: Don't you watch the news? This is a superhero bar.");
    printWords("Mecha Man: Oh, wow, are you a superhero? That's so cool.");
    printWords("Is this your power?");
    printWords("You're like, tell people obvious shit guy?");

    printWords("Person: You're really gonna act like you don't remember me?");
    printWords("Mecha Man: Wait, it's coming back to me...");
    printWords("Yeah, it's coming back to me...");

    // Character identity choice
    cout << "\n+---------------------------------------+\n";
    cout << "|  Choose Your Insult:                  |\n";
    cout << "+---------------------------------------+\n";
    cout << "|  1. Dr. Don't Do Shit                 |\n";
    cout << "|  2. Mr. Wet Ponytail                  |\n";
    cout << "|  3. Sunglasses at Night Guy           |\n";
    cout << "+---------------------------------------+\n";
    cout << "Choice: ";
    choice = readChoice(1, 3);

    printWords("Oh wait, I know it.");

    if (choice == 1) {
        printWords("You are Dr. Don't Do Shit.");
        printWords("Your deal is you walk up to people, look threatening, talk a big game, then don't do shit about it.");
        printWords("Also, you're not a real doctor cause you're a fuckin' idiot.");
        impressionScore += 1;  // Witty comeback
        publicChaos += 1;      // Causing a scene
    }
    else if (choice == 2) {
        printWords("You are Mr. Wet Ponytail.");
        printWords("Your superpower is in your ponytail, which aside from being disgusting, has the ability to never not be wet.");
        printWords("In battle, you whip it around and anyone it touches fuckin' kills themself.");
        impressionScore += 2;  // Most creative/disgusting
        publicChaos += 2;      // People are grossed out
    }
    else if (choice == 3) {
        printWords("You are Sunglasses Indoors at Night Guy.");
        printWords("Your superpower is letting everyone know in the room that you're a douchebag.");
        printWords("Cause you should literally never do that.");
        impressionScore += 1;  // Solid burn
        publicChaos += 1;
    }
    
    printLines("*Scattered laughter around the bar*");
    printLines("*Someone in the corner chokes on their drink*");
    
    printWords("Person: You good?");
    printWords("Woman: Sorry, I choked on my spit.");
    printWords("Person: No, Mecha Bitch. I control the fire--");

    printWords("Mecha Man: The fire?");
    printWords("Person: And the flame.");
    printWords("And my skin does not burn.");
    printWords("I am Flambae.");

    printWords("Mecha Man: Wait, oh shit. I do remember you.");
    printWords("You're that shitty villain I busted up.");

    printWords("Flambae: Not anymore, Mecha Dick.");
    printWords("As I literally just said, I am Flambae, a real superhero.");
    printWords("And you are not Mecha Man anymore.");
    printWords("So you need to get the fuck out of here.");

    printLines("\n*Flambae's body ignites with flames*  ðŸ”¥");
    this_thread::sleep_for(chrono::milliseconds(800));

    // Water or Alcohol choice - THE CRITICAL DECISION
    cout << "\n+---------------------------------------+\n";
    cout << "|  What do you throw?                   |\n";
    cout << "+---------------------------------------+\n";
    cout << "|  1. Water (Efficient)                 |\n";
    cout << "|  2. Alcohol (Memorable)               |\n";
    cout << "+---------------------------------------+\n";
    cout << "Choice: ";
    choice = readChoice(1, 2);

    if (choice == 1) {
        // WATER - Efficient but unremarkable
        printLines("\n*You grab a glass of water and throw it*  (ã£ãƒ»Ï‰ãƒ»)ã£ðŸ’§");
        printLines("*SSSSSSS - Steam rises as the flames extinguish*");
        
        printWords("Mecha Man: There. The easy way.");
        printWords("Flambae: I've been waiting a long time for this.");
        printLines("*Flambae charges forward, slips on the wet floor*");
        printLines("*THUD*  (x_x)");
        printWords("Flambae: ...ow.");
        
        printLines("*Coupe and Punch-up rush over to help*");
        printWords("Dobble: Hey, why don't you do us a favor and step out of this bar.");        
        printWords("Mecha Man: I get it. Can you just tell Blazer I'm outside?");
        printLines("*Dopple duplicates himself, blocking the door*");
        printWords("Dopple: OUT!");
        printWords("Mecha Man: Relax! I'm leaving.");
        
        publicChaos += 1;       // Minor scene
        impressionScore += 2;   // Competent and efficient
        
        printLines("\n*Blonde Blazer watches from across the room*");
        printWords("Blonde Blazer (thinking): Well... that was sensible.");
        printWords("Blonde Blazer (thinking): Boring, but sensible.");
        
        cout << "\n[Blonde Blazer noticed your tactical efficiency]\n";
        
    } else if (choice == 2) {
        // ALCOHOL - Dramatic and unforgettable (PROJECT REQUIREMENT: Higher impression!)
        printLines("\n*You grab a bottle of alcohol and throw it*  (ã£ðŸ”¥)ã£ðŸ¥ƒ");
        this_thread::sleep_for(chrono::milliseconds(500));
        printLines("*WHOOOOOOSH!*");
        printLines("*The flames EXPLODE upward in a massive fireball*  ðŸ”¥ðŸ”¥ðŸ”¥");
        
        printWords("Flambae: AAAHHHHHHH!");
        printWords("Mecha Man: Sorry, which way was that?");
        
        printLines("*A waiter hurries over with a tray*");
        printWords("Waiter: HEY! What the hell?!");
        printWords("Coupe: No, Punch-up, you are literally fanning the flames right now!");
        printWords("Punch-up: Shit, you're right! Anybody got a rug?");
        printWords("Flambae: FUCK! FUCK! IT BURNS!");
        
        printLines("*Flambae runs around in circles, hair ablaze*");
        printLines("*CRASH* *He knocks over three tables*");
        printLines("*Flambae finally rushes out the door, still screaming*");
        
        printWords("Punch-up: You gotta drop and roll, lad!");
        printWords("Mecha Man: I thought he doesn't burn?");
        printWords("Coupe: Some people become scared before they even know they're hurt...");
        printWords("Coupe: ...like babies.");
        printLines("*Coupe shakes his head and walks out after Flambae*");
        
        this_thread::sleep_for(chrono::milliseconds(1000));
        printLines("*Awkward silence fills the bar*");
        
        printWords("Dopple: HEY! Mecha Dick. Get the FUCK out of here. NOW.");
        printWords("Mecha Man: I get it. Can you just tell Blazer I'm outside?");
        printLines("*Dopple duplicates himself, both copies glaring*");
        printWords("Dopple: OUT!");
        printWords("Mecha Man: Relax! I'm leaving.");
        
        publicChaos += 3;       // MAJOR chaos
        impressionScore += 5;   // MEMORABLE - PROJECT REQUIREMENT!
        
        printLines("\n*Blonde Blazer is wide-eyed, hand covering her mouth*");
        this_thread::sleep_for(chrono::milliseconds(800));
        printWords("Blonde Blazer (thinking): Holy shit.");
        printWords("Blonde Blazer (thinking): That was... I mean, terrible, but...");
        printWords("Blonde Blazer (thinking): I cannot believe he just did that.");
        printLines("*She's fighting back a smile*");
        printWords("Blonde Blazer (thinking): ...I will never forget this moment.");
        
        cout << "\n[â˜…â˜…â˜… UNFORGETTABLE IMPRESSION - Blonde Blazer will remember this â˜…â˜…â˜…]\n";
    }

    // End scene summary
    cout << "\n=========================================\n";
    cout << "         End of Scene 4\n";
    cout << "=========================================\n";
    
    // Show status with context
    cout << "\n+======================================+\n";
    cout << "|      REPUTATION UPDATE               |\n";
    cout << "+======================================+\n";
    
    if (impressionScore >= 6) {
        cout << "|  Blazer's Memory: VIVID ***          |\n";
    } else if (impressionScore >= 3) {
        cout << "|  Blazer's Memory: Notable **         |\n";
    } else {
        cout << "|  Blazer's Memory: Forgettable *      |\n";
    }
    
    if (publicChaos >= 3) {
        cout << "|  Bar Status: TOTAL CHAOS (!)         |\n";
    } else if (publicChaos >= 2) {
        cout << "|  Bar Status: Disrupted (!)           |\n";
    } else {
        cout << "|  Bar Status: Under Control (OK)      |\n";
    }
    
    cout << "|                                      |\n";
    cout << "|  Impression Score: " << impressionScore << "/10    |\n";
    cout << "|  Chaos Level: " << publicChaos << "/10         |\n";
    cout << "+======================================+\n\n";
}

/* ---------- Standalone Main ---------- */
int main() {
    cout << "\n";
    cout << "+==========================================+\n";
    cout << "|                                          |\n";
    cout << "|        DISPATCH: Robert's Story          |\n";
    cout << "|         Scene 4 - Bar Test               |\n";
    cout << "|                                          |\n";
    cout << "+==========================================+\n";
    
    scene_bar_flambae();
    
    cout << "\n[Press Enter to Exit]";
    cin.get();
    return 0;
}
